---
title: "Who survived the Titanic?"
subtitle: "Factors contributing to the survival of passengers in the historic Titanic accident of 1912 "
author: "XEM Team <br> Chenyu Li, Emma Ghelfi, Maria Stylianou, Xiao Hu"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
  
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(dplyr)
library(vcd)
library(grid)
library(rsample)
library(ggplot2)
library(ggpol)
library(scales)
library(caret)
library(corrplot)
library(parsnip)

```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%" )
```

```{r load-data, include=FALSE}
titanic <- read.csv(here::here("data/titanic.csv"))
glimpse(titanic)
```

```{r, include=FALSE}
style_xaringan(
  title_slide_background_image = "img/titanicpic.jpg" , title_slide_text_color = "ghostwhite" , background_color = "bisque2" , text_color = "gray28" )
```


class: center, middle

#Content
- Background information
- Introduction to data set
- Data analysis
- Modelling
- Bibliography
---

#Background information 


"Touted as the ultimate in transatlantic travel and said to be “unsinkable”, the Titanic collided with an iceberg on 14 April 1912 on her maiden voyage and sank shortly thereafter on 15 April, killing 1502 out of 2224 passengers and crew." [1]

We want to see 

### If and how the chance of survival of Titanic passengers is related to different attributes of the passengers 

---

class: inverse, center, middle

# Section title

####If and how the chance of survival of Titanic passengers is related to different attributes of the passengers


---

# Introduction to data set
* The data set comes from the Awesome Public Data Sets on GitHub[2]

* There are 12 variables and 891 observations in this data set. 
.pull-left[
- `Name`: Name and Surname of passenger, if available 
- `Survived`: If passenger survived (0 = No, 1 = Yes)
- `Sex`: Gender of passenger (male or female)
- `Age`: Age in years
- `Pclass`: Passenger class (1 = 1st, 2 = 2nd, 3 = 3rd) 
- `Fare`: Passenger fare (i.e. cost of ticket in USD)
- `Embarked`: Port of embarkation (C = Cherbourg, Q = Queenstown, S = Southampton)[3] ]

---
class: inverse, middle, center
# Hypothesis 1: Women have a higher survival rate than men

---


# Introduction
* During the times when the sinking of the Titanic accident occurred (1912), in the spirit of chivalry women (and children) were saved first. This was historically recorded as orders from the captain of the Titanic.

---

# Visualization
.pull-left[
- Use gender as the predictor variable and frequency displayed in terms of colors showing survivals or not as the outcome variable
]

.pull-right[
```{r gender-survival,out.width="100%", fig.width=4, echo=FALSE}
titanic$Survived <- as.factor(titanic$Survived)
titanic$Pclass <- as.factor(titanic$Pclass)

titanic %>%
  ggplot(mapping = aes(x = Sex, fill = Survived)) +
  geom_bar() +
  theme_minimal() +
  scale_fill_viridis_d(name = "Survived", labels = c("No", "Yes" )) +
  labs(x = "Sex", 
       y = "Frequency", 
       title = "Survival Rate by Gender") +
  theme(legend.position = "bottom")
```
]








---
# Summary
.pull-left[
- The proportion of women passengers who survived is 0.68 
- The proportion of men passengers who survived is 0.32
]
.pull-right[
```{r survival_rate_gender,  fig.width=4, echo = FALSE}
titanic %>%
  filter(Survived == "1") %>%
  count( Sex ) %>%
  mutate(prop_survival = n/sum(n))
```
]
---
class: inverse, middle, center
# Hypothesis 2: The younger survivals are more than the older survivals
---
# Why do we come up with this hypothesis ?
- give priority to saving infants and children when it comes to providing life saving equipment

- physical abilities
---
# Data analysis 
.pull-left[
```{r age-survival,out.width="100%", fig.width=4, echo=FALSE, warning=FALSE}
titanic %>% 
  ggplot(mapping = aes(x = Age, fill = Survived)) +
  geom_histogram(binwidth = 5 ) +
  theme_minimal() +
  scale_fill_viridis_d(name = "Survived", labels = c("No", "Yes")) +
  labs(x = "Age", 
       y = "Frequency", 
       fill = "Survived", 
       title = "Survival rate by age") +
  theme(legend.position = "bottom")
```

```{r age-survival-rate,echo=FALSE}
titanic_test  <- titanic %>%
  filter(!is.na(Age)) %>%
  mutate(Age_Range = case_when(Age >= 0  & Age <= 10 ~ "0-10",
                               Age >= 11 & Age <= 20 ~ "11-20",
                               Age >= 21 & Age <= 30 ~ "21-30",
                               Age >= 31 & Age <= 40 ~ "31-40",
                               Age >= 41 & Age <=50 ~  "41-50",
                               Age >= 51 & Age <=60 ~  "51-60",
                               Age >= 61 & Age <= 70 ~  "61-70",
                               Age >= 71 & Age <= 80 ~ "71-80")) %>%
  count(Age_Range) %>%
  mutate(prop_survival = n/sum(n)) 
```


```{r, echo=FALSE}
#pie(titanic_test$n,labels =round((titanic_test$prop_survival)*100, digits=2), col= rainbow(8))
#legend("topleft", legend = titanic_test$Age_Range,fill= rainbow(8))
```
]
---

class: inverse, middle, center
# Is wealth associated with passengers' survival rate ?
---
# Ticket Price & Passengers' Class 

.pull-left[
```{r fare-boxplot , echo=FALSE , out.width = '1200'}
Survived_words <- ( c( "0" = "DidnotSurvive",
                       "1" = "Survived" ))

titanic %>% 
  ggplot(aes(x = Pclass , y = Fare )) +
  geom_boxplot(outlier.shape = NA , alpha = 0.2  ) +
  geom_jitter(width = 0.2 , alpha = 0.2, size = 0.3 ) +
  coord_cartesian(ylim = c(0,300))+
  facet_grid(~Survived , labeller = as_labeller(Survived_words)) +
  theme_minimal() + 
   scale_x_discrete(labels=c("1" = "1st Class", "2" = "2nd Class",
                              "3" = "3rd Class")) +
  scale_y_continuous(labels = label_dollar(
  accuracy = NULL,
  scale = 1,
  prefix = "$" )) +
  labs( x = "Passengers' Class" ,
        y = "Ticket Price" , 
        title = "Ticket Price Distribution by Class" ,
        subtitle = "For Survived and non Survived Passengers" ) +
 theme(plot.background = element_rect(fill = "wheat2")) 

```
]

.pull-right[ 
```{r fare-median , echo = FALSE , message=FALSE}
titanic_median_pclass <- titanic %>%
  mutate(Survived = case_when( Survived == "0" ~ "No" ,
                               Survived == "1" ~ "Yes")) %>%
mutate(Passenger_Class = case_when( Pclass == "1" ~ "1st Class" ,
                                    Pclass == "2" ~ "2nd Class",
                             Pclass == "3" ~ "3rd Class")) %>%
  group_by(Passenger_Class , Survived) %>%
  summarize(Median_Price_USD = median(Fare))
knitr::kable(head(titanic_median_pclass), format = 'html')
```
] 

---

class: middle, center

```{r class-survival , echo = FALSE}
titanic$Survived <- as.factor(titanic$Survived)
titanic$Pclass <- as.factor(titanic$Pclass)

titanic %>%
  group_by(Pclass) %>%
  count(Survived) %>%
  mutate(pct = n/sum(n)) %>%
  mutate(pctrounded = round(pct , 3)) %>%
  ggplot(aes(x = Pclass , y = pctrounded*100 ,  fill = Survived , label = scales::percent( pctrounded))) +
  geom_bar( position = position_dodge(), stat = "identity", width = .7) +
 geom_text(aes(y = pctrounded*100 , label = scales::percent(pctrounded)) , position = position_dodge(width = .7), vjust = -0.5,size = 3) +
  labs(x = "Passengers' Class" , 
       y = "Precentage" , 
       fill = "Survival", 
       title = "Percentage of passengers who surived or not" ,
       subtitle = "By passengers' class") +
  scale_y_continuous(labels = label_percent(
  scale = 1 )) +
  theme_minimal() +
  scale_x_discrete(labels=c("1" = "1st Class", "2" = "2nd Class",
                              "3" = "3rd Class")) +
  theme(plot.background = element_rect(fill = "wheat2")) +
   scale_fill_manual(name = "Survived", labels = c("No", "Yes") , 
                     values = c("0" = "sandybrown",
                                "1" = "tan3"))
```

---
class:middle, center

```{r , echo=FALSE }
titanic %>%
  filter( Embarked == "Q" | Embarked == "S" |Embarked == "C") %>%
  group_by(Embarked , Pclass) %>%
  count(Survived) %>%
  mutate(pct = n/sum(n)) %>%
  mutate(pctrounded = round(pct, 3))  %>%
  filter( Survived == "1") %>%
  ggplot(aes(x = Embarked , y = pctrounded *100 ,  fill = Pclass , label = scales::percent( pctrounded)))+
  geom_bar( position = position_dodge(), stat = "identity", width = .7) +
 geom_text(aes(y = pctrounded*100, label = scales::percent( pctrounded)) , position = position_dodge(width = .7), vjust = -0.5,size = 2 ) +
  scale_y_continuous(labels = label_percent(
  scale = 1 ))  +
  theme_minimal() +
  coord_cartesian(ylim = c(0,80)) +
   theme(plot.background = element_rect(fill = "wheat2")) +
   scale_fill_manual(name = "Passengers' Class", 
                     labels = c("1st Class", "2nd Class ","3rd Class" ),
                     values = c("1" = "sandybrown",
                               "2" = "tan3" ,
                               "3" = "cornsilk2")) +
  scale_x_discrete(labels=c("S" = "Southampton", "C" = "Cherbourg",
                              "Q" = "Queenstown")) +
  labs( x = "Port of Embarkation" ,
        y = "Percentage" , 
        title = "Percentage of Passengers who survived for each class  " ,
        subtitle = "by Port of Embarkation" ) 


``` 

---

# Port of Embarkation & Ticket Price 
.pull-left[
```{r , echo=FALSE}

Survived_words <- ( c( "0" = "DidnotSurvive",
                       "1" = "Survived" ))

titanic %>% 
  filter( Embarked == "Q" | Embarked == "S" |Embarked == "C") %>%
  ggplot(aes(x = Embarked , y = Fare )) +
  geom_boxplot(outlier.shape = NA , alpha = 0.2  ) +
  geom_jitter(width = 0.2 , alpha = 0.2, size = 0.3 ) +
  coord_cartesian(ylim = c(0,300))+
  facet_grid(~Survived , labeller = as_labeller(Survived_words)) +
  theme_minimal() + 
   scale_y_continuous(labels = label_dollar(
  accuracy = NULL,
  scale = 1,
  prefix = "$" )) +
  labs( x = "Passengers' Class" ,
        y = "Ticket Price" , 
        title = "Ticket Price Distribution by Port of Embarkation" ,
        subtitle = "For Survived and non Survived Passengers" ) +
 theme(plot.background = element_rect(fill = "wheat2")) +
  scale_x_discrete(labels=c("S" = "Southampton", "C" = "Cherbourg",
                              "Q" = "Queenstown"))
```
]
.pull-right[
```{r , echo=FALSE , message=FALSE}
titanic_median_embarked <- titanic %>%
filter( Embarked == "Q" | Embarked == "S" |Embarked == "C") %>%
  mutate(Survived = case_when( Survived == "0" ~ "No" ,
                                    Survived == "1" ~ "Yes")) %>%
  mutate(Port_of_Embarkation = case_when( Embarked == "S" ~ "Southampton" ,
                                          Embarked == "C" ~ "Cherbourg",
                                          Embarked == "Q" ~ "Queenstown")) %>%
  group_by( Port_of_Embarkation , Survived) %>%
  summarize(Median = median(Fare)) %>%
  mutate(Median_Price_USD = round(Median, 2)) %>%
  select( Port_of_Embarkation ,Survived,Median_Price_USD )
knitr::kable(head(titanic_median_embarked), format = 'html')
```
]
---


class: inverse, center, middle

# Predictive model for survival on the titanic

---

class: inverse, center, middle

# Recreating G. Bron's "Sphere" Diagram

---
## G. Bron's original Diagram on "the Sphere", 1912
.left-column[```{r Gbron-original-chart, echo = FALSE, out.width = "120%", fig.align = "right", fig.cap = "G.Bron's chart of 'The Loss of the Titanic', 4 May 1912." }
include_graphics("https://www.researchgate.net/profile/Michael-Friendly/publication/330916468/figure/fig1/AS:723679168196613@1549549967751/GBrons-chart-of-The-Loss-of-the-Titanic-from-The-Sphere-4-May-1912-Each-subgroup.png")
```
]
.right-column[
+ The Sphere: popular British illustrated weekly newspaper (1900-1964). It was dedicated to worldwide reporting on popular issues. 
{{content}}

]

--

+ G. Bron, graphic artist, used data released the week before by the House of Commons for the visualisation pubblished on 4 May 1912, **three weeks after the Titanic disaster**
{{content}}

--

+  Bron’s graph is an early innovation in data display:
{{content}}


--

    + each subgroup is shown by a bar whose area is proportional to the numbers of cases
{{content}}   

-- 

    + Within the passenger classes, the bars are subdivided by gender for adults, while children are shown as a separate group. 
{{content}}

--

    + It also includes summary panels, showing the totals for passengers and crew.
{{content}}
  
--

+  Today, we might describe this as an early form of a mosaic plot, or as an area-proportional back-to-back array of bar charts





---
```{r}
#titanic_freq <- titanic %>%
#  mutate(ischild = ifelse(Age >= 18, "adult", "child"),
#         issurvived = ifelse(Survived == 0, "no", "yes")
#        ) %>%
#  group_by(ischild, Sex, Pclass, issurvived) %>%
#  summarise(Freq = n()) %>%

#vcd::doubledecker(issurvived ~ Pclass + Sex, 
#                  xtabs(Freq ~ Sex + issurvived + Pclass, titanic_freq))
# Mosaic double decker plot

#``` {r table-mosaic, echo=FALSE, results = 'hide'}
titanic_child <- titanic %>%
  mutate(ischild = ifelse(Age >= 18, "adult", "child"))
  
tbl <- xtabs(~Survived + Pclass + Sex + ischild, titanic_child)
ftable(tbl)


```

``` {r mosaic plot, echo = FALSE, fig.align = 'center'}
# mosaic(~ Survived + Pclass + Sex + ischild, data = titanic_child, 
      # highlighting = "Survived", highlighting_fill = c("#727272", "#79c36a"),
     #  labeling_args = list(set_varnames = c(Sex = "Gender",
                                           #  Survived = "Survived",
                                           #  Pclass = "Passenger Class",
                                           #  ischild = "Child")),
       # set_labels = list(Survived = c("No", "Yes"),
                         # Pclass = c("1st", "2nd", "3rd", "Crew"),
                        #  Sex = c("F", "M"),
                         # ischild = c("A","C")),
      # main = "Survival on the Titanic")
```


---
## Aside

.pull-left[
Brath (2018) created mosaic plots filling the tiles with the names of the victims and survivors among the 1308 passengers. 

> This highlights the fact that the passengers were people, not statistics. It's common to overlook on this while handling data that has to do with casualties.

* This is also an example of how typography could be used in data visualization.
]

.pull-right[
```{r brath2018-plot, echo=FALSE, out.width = '100%'}
knitr::include_graphics("img/brath2018.png")
```
]

.footnote[
Brath, Richard. 2018. “Text in Visualization: Extending the Visualization Design Space.” PhD thesis, London South Bank University.
]

---
#Bibliography
[1] Source: Friendly, M., Symanzik, J., &amp; Onder, O. (2019, February 6). Royal Statistical Society Publications. Royal Statistical Society. Retrieved November 19, 2021, from https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1740-9713.2019.01229.x. 

https://rkabacoff.github.io/datavis/Models.html#Mosaic 


https://www.datavis.ca/papers/titanic/

https://www.datavis.ca/papers/titanic/ 

[2] https://github.com/awesomedata/awesome-public-datasets

[3] https://www.kaggle.com/c/titanic/data